[TOC]



# 安装VPS



## 服务器位置的选择

**这个很重要！！**

尝试东京节点，发现很不稳定，有时很快，优势很慢；

美国的服务器ping之后，选择西海岸，如：Silicon Valley 、seattle 、Los Angeles等；

> 切记：**一定要多布置几个服务器，然后ping测试，因为每次布置的IP不同，ping值会有很大不同，要看运气啦；**这里不光本机测试，还要测试全国的ping：http://ping.chinaz.com/





## 安装自定义centOS系统

- 先找VPS附近的centOS镜像：https://www.centos.org/download/mirrors/，在vultr后台添加\下载ISO文件（DVD1）;
- 选择配置,进行deploy,先安装vultr自带的系统;
- 进入案例（Instance）-Setting-CustomeISO-Attach ISO and Reboot-View Console，安装**minimal**，
- 分区参考: swap=2倍内存; boot=200M; 其他全部给`/`即可;

# 配置、优化VPS



## 启动网卡

使用`ifconfig`查看启用的网卡(`ifconfig -a`查看所有网卡)，倘若没有**eth0**,说明没有启用,执行`ifup eth0`即可。

注意：此时只是临时开启网卡eth0，重启电脑的话，eth0便会关闭，可以在以下文件中看到，网卡配置文件并没有改：

`vi /etc/sysconfig/network-scripts/ifcfg-eth0`

查看22端口是否正常
` netstat -ntlp`

## SSH连接vps

ifconfig命令查看ip，



## 更新系统



``` sh
cat /etc/issue #查看系统版本
yum clean all #清空yum缓存，yum安装时会把软件包和header存储在cache中，大多在/var/cache/yum中，而不自动删除。如果觉得占用磁盘空间，yum clean all一全部清除。
yum makecache #生成缓存
yum upgrade #开始更新软件、系统，但是不更新内核（而update还会更新内核，慎用！！）
```



## 修改ip地址、网关、主机名、DNS #eth0 网卡设置

网卡配置

```sh
cp /etc/sysconfig/network-scripts/ifcfg-eth0 /etc/sysconfig/network-scripts/ifcfg-eth0.bak #养成备份原文件的习惯
vi /etc/sysconfig/network-scripts/ifcfg-eth0
DEVICE=eth0 #网卡设备名称
HWADDR=00:0C:29:D0:C7:B5 #以太网设备的对应的物理地址
TYPE=Ethernet #网络类型为以太网模式
UUID=080a457b-6a53-4a3a-9155-a23c1146c2c6 #通用唯一识别码
ONBOOT=yes #是否启动引导的时候激活YES
NM_CONTROLLED=no #设备eth0是否可以由Network Manager图形管理工具托管
BOOTPROTO=dhcp #静态IP地址获取状态 如：DHCP表示自动获取IP地址
IPADDR=192.168.1.10 #IP
IPV6INIT=no
IPV6_AUTOCONF=no
NETMASK=255.255.255.0 #网卡对应的网络掩码
GATEWAY=192.168.1.1 #网关地址
```

网关配置

```sh
vi /etc/sysconfig/network
#表示系统是否使用网络，一般设置为yes。如果设为no，则不能使用网络，而且很多系统服务程序将无法启动
NETWORKING=yes
#设置本机的主机名，这里设置的主机名要和/etc/hosts中设置的主机名对应
HOSTNAME=c65mini.localdomain
#设置本机连接的网关的IP地址。例如，网关为10.0.0.1或者192.168.1.1
GATEWAY=192.168.1.1
```

修改主机DNS

```sh
vi /etc/resolv.conf #内容如下:
; generated by /sbin/dhclient-script
nameserver 8.8.8.8
nameserver 4.4.4.4
```

修改HOSTS

```sh
vi /etc/hosts #如下：
127.0.0.1 lvtao.localdomain
#使用DNS域名服务器来解析名字
order bind hosts
#一台主机是否存在多个IP
multi on
#如果用逆向解析找出与指定的地址匹配的主机名，对返回的地址进行解析以确认它确实与您查询的地址相配。为了防止“骗取”IP地址
nospoof on
```

重启网卡生效设置两种方法

```sh
service network restart
或者
/etc/init.d/network restart
```



## 关闭selinux，清空iptables 

在开启selinux的情况下，会限制很多服务器配置。**在服务器配置完全成功后各项服务正常后，再开启selinux。**

**查看selinux状态**

- 第一种方法：/usr/bin/setstatus -v #如果显示：SELinux status: enabled 就是开启状态
- 第二种方法：cat /etc/selinux/config #如果显示：SELINUX=enforcing 则是开启状态permissive有提醒的状态 disabled是关闭
- 第三种方法：grep SELINUX=disabled /etc/selinux/config
- 第四种方法：getenforce

**修改selinux状态**

如果修改配置文件则永久生效，但是必须要重启系统

- 第一种：vi /etc/selinux/config 修改 SELINUX=disabled
- 第二种：sed –i ‘s/SELINUX=enforcing/SELINUX=disabled/g’ /etc/selinux/config

如果想立即生效（如果想临时性的改变） setenforce 0
setenforce 1 设置SELinux 成为enforcing模式 setenforce 0 设置SELinux 成为permissive模式 查看状态 getenforce

iptables防火墙规则清理了，根据需求定制;

*iptables命令是Linux上常用的防火墙软件，是netfilter项目的一部分。可以直接配置，也可以通过许多前端和图形界面配置。*

```sh
1、重启后永久性生效：
chkconfig iptables on #开启
chkconfig iptables off #关闭

2、即时生效，重启后失效：
service iptables start #开启
service iptables stop #关闭
service iptables restart #重启

在开启了防火墙时，做如下设置，开启相关端口，修改 /etc/sysconfig/iptables 文件，添加以下内容：
-A INPUT -m state --state NEW -m tcp -p tcp --dport 80 -j ACCEPT   #允许80端口通过防火墙
-A INPUT -m state --state NEW -m tcp -p tcp --dport 3306 -j ACCEPT   #允许3306端口通过防火墙
 
```



## 创建普通用户并进行sudo授权管理

创建用户，并修改密码：

```sh
useradd xxx #添加用户
passwd xxx #修改用户xxx的密码
```

对xxx用户进行授权，修改 /etc/sudoers 文件

```sh
90 ## Allow root to run any commands anywhere
91 root    ALL=(ALL)       ALL
92 yaro    ALL=(ALL)       ALL #添加此行
```

对xxx授权完毕后，可以用xxx帐号登录，然后用命令 `sudo –` ，即可获得root权限进行操作。



## 修改SSH端口号和屏蔽root账号远程登陆

```sh
cp /etc/ssh/sshd_config sshd_config_bak #进入文件夹，备份SSH配置
vi /etc/ssh/sshd_config #修改SSH安全配置 
port 1985 #SSH链接默认端口
PermitRootLogin no #禁止root账号登陆
PermitEmptyPasswords no#禁止空密码
UseDNS no #不使用DNS
```

**切记：修改SSH端口后，防火墙一定要放行此端口。**

重新载入SSH配置 /etc/init.d/sshd reload 查看端口里面是否有刚才修改过的端口号

```sh
netstat -lnt
或者反查端口是那个进程
lsof -i tcp:52113 #centos6.5最小化安装没有lsof工具需要 yum install lsof
```



## 锁定关键文件系统（禁止非授权用户获得权限）

一定要设置好之后再执行如下命令，否则很多程序无法正常安装配置：如mysql-server安装时需要添加mysql用户和用户组；执行如下命令之后，便不能添加了。

```sh
chattr +i /etc/passwd  # i：不得任意更动文件或目录；
chattr +i /etc/inittab
chattr +i /etc/group
chattr +i /etc/shadow
chattr +i /etc/gshadow
```



## 精简开机自启动服务

可以禁用的服务参考网页：http://ponyjia.blog.51cto.com/917324/1860403

**注意:**  如果是中文的话。可能会需要LANG=en 或者替换 3:on 成 3:启用

```sh
#或者
chkconfig --list|grep 3:on
#开启需要的服务
sudo chkconfig kdump on # off 关闭
```



## 设置系统字符集

第一种：`vi /etc/sysconfig/i18n`

修改内容：如果想用中文提示：LANG="zh_CN.UTF-8" 如果想用英文提示：LANG="en_US.UTF-8"

如果临时切换也可以直接在Bash输入命令：LANG=zh_CN.UTF-8

第二种：使用sed快速替换

```sh
#替换成英文
sed -i 's#LANG="zh_CN.*"#LANG="en_US.UTF-8"#' /etc/sysconfig/i18n
#替换成中文
sed -i 's#LANG="en_US.*"#LANG="zh_CN.UTF-8"#' /etc/sysconfig/i18n
#替换成UTF-8中文
sed -i 's#LANG="zh_CN.*"#LANG="zh_CN.UTF-8"#' /etc/sysconfig/i18n
```



## 清理登陆的时候显示的系统及内核版本

```sh
#查看登陆信息 
cat /etc/redhat-release 
cat /etc/issue 
#清理登陆信息
echo >/etc/redhat-release 
echo >/etc/issue
```



## 内核参数优化 vi /etc/sysctl.conf

这是一个在网络上流传已久的sysctl.conf优化配置

参考网页：	https://wsgzao.github.io/post/sysctl/ 有简要解释

​			http://www.ha97.com/4396.html 有详细解释

最后记得刷新立即生效`/sbin/sysctl -p`

## 关闭重启ctl-alt-delete组合键

inux默认允许任何人按下Ctrl+Alt+Del来重启系统。但是在生产环境中，应该停用按下Ctrl-Alt-Del 重启系统的功能。会linux的技术牛们都知道前面的centos版本都是在/etc/inittab中配置，它会告诉你Ctrl+Alt+Del这个功能键在哪里设置。

```sh
vi /etc/init/control-alt-delete.conf
#注释掉一下这句：
exec /sbin/shutdown -r now "Control-Alt-Delete pressed"
```



# 安装LEMP

